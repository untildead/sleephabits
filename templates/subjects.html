{% extends "base.html" %}
{% block content %}
<div class="flex items-center justify-between mb-4">
    <div>
        <h1 class="text-2xl font-semibold text-slate-800">Subjects</h1>
        <p class="text-sm text-slate-500">Filtra por género, edad o tags y administra los sujetos.</p>
    </div>
    <a href="/api/reports/subjects.csv" class="inline-flex items-center text-sm bg-slate-900 text-white px-3 py-2 rounded hover:bg-slate-700">Exportar CSV</a>
</div>

<div class="grid md:grid-cols-3 gap-6">
    <div class="md:col-span-2 bg-white p-4 rounded shadow">
        <form id="subject-filters"
              class="flex flex-wrap gap-3 items-end mb-4"
              hx-get="/partials/subjects-table"
              hx-target="#subjects-table"
              hx-trigger="change, submit"
              hx-push-url="true">
            <div>
                <label class="block text-xs uppercase text-slate-500">Género</label>
                <input type="text" name="gender" value="{{ filters.gender }}" class="border rounded px-2 py-1 w-32" placeholder="F/M">
            </div>
            <div>
                <label class="block text-xs uppercase text-slate-500">Edad mínima</label>
                <input type="number" name="age_min" value="{{ filters.age_min }}" class="border rounded px-2 py-1 w-28">
            </div>
            <div>
                <label class="block text-xs uppercase text-slate-500">Edad máxima</label>
                <input type="number" name="age_max" value="{{ filters.age_max }}" class="border rounded px-2 py-1 w-28">
            </div>
            <div class="flex-1">
                <label class="block text-xs uppercase text-slate-500">Buscar</label>
                <input type="text" name="q" value="{{ filters.q }}" class="border rounded px-2 py-1 w-full" placeholder="nombre/género/tag">
            </div>
            <button class="bg-amber-500 text-white px-3 py-2 rounded hover:bg-amber-600" type="submit">Filtrar</button>
        </form>
        {% include "partials/subjects_table.html" %}
    </div>
    <div class="bg-white p-4 rounded shadow space-y-4">
        <h2 class="text-lg font-semibold">Crear/editar</h2>
        <form data-api-action="/api/subjects" data-api-method="POST" data-refresh-target="#subjects-table" data-refresh-url="/partials/subjects-table" class="space-y-3">
            <div>
                <label class="block text-xs uppercase text-slate-500">Nombre</label>
                <input type="text" name="name" class="border rounded px-2 py-1 w-full" placeholder="Opcional">
            </div>
            <div>
                <label class="block text-xs uppercase text-slate-500">Edad</label>
                <input type="number" name="age" min="0" required class="border rounded px-2 py-1 w-full">
            </div>
            <div>
                <label class="block text-xs uppercase text-slate-500">Género</label>
                <input type="text" name="gender" required class="border rounded px-2 py-1 w-full" placeholder="F/M/O">
            </div>
            <div>
                <label class="block text-xs uppercase text-slate-500">Tags</label>
                <select multiple name="tag_ids" class="border rounded px-2 py-1 w-full h-24">
                    {% for tag in tags %}
                    <option value="{{ tag.id }}">{{ tag.name }}</option>
                    {% endfor %}
                </select>
                <p class="text-xs text-slate-500 mt-1">Ctrl/⌘ + clic para seleccionar múltiples.</p>
            </div>
            <button type="submit" class="w-full bg-emerald-600 text-white px-3 py-2 rounded hover:bg-emerald-700">Guardar</button>
        </form>
        <div class="pt-3 border-t">
            <h3 class="text-sm font-semibold mb-2">Nuevo tag</h3>
            <form data-api-action="/api/tags" data-api-method="POST" data-refresh-target="#subjects-table" data-refresh-url="/partials/subjects-table" class="flex gap-2">
                <input type="text" name="name" required class="border rounded px-2 py-1 flex-1" placeholder="Etiqueta">
                <button class="bg-slate-900 text-white px-3 py-1 rounded">Crear</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
